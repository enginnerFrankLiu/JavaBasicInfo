使用MQ都要考虑到的问题

MQ 的使用场景和用途

1.MQ 如何保证消息不丢失(消息的可靠性)?

2.MQ 如何保证消息不被重复消费?

3.MQ 如何保证消息队列的高可用?

4.如何保证消息按顺序执行?

5.消息积压在队列中如何处理?



一个是尽量去避免消息大量堆积的情况
1.设置消息的过期时间TTL,消息过期后，通过死信交换机 进入死信队列-> 存到DB中，后面再重新导入到MQ 中重新消费

2.当事情已经发生了的处理方式：
先修复consumer的问题，确保其恢复消费速度，然后将现有consumer都停止
临时建立好原先10倍或者20倍的queue数量
然后写一个临时的分发数据的consumer程序，这个程序部署上去消费积压的数据，消费之后不做耗时的处理，直接均匀轮询写入临时建立好的10倍数量的queue
接着临时征用10倍机器来部署consumer，每一批consumer消费一个临时queue的数据
这种做法相当于临时将queue资源和consumer资源扩大了10倍，以正常的10倍速度



消息发送到MQ中，本身MQ 就是一个先进先出的queue，出现乱序的往往是消费端的
比如：
多个消费者，监听同一个queue,当有序的消息A - B -C 分别到达queue后，分别发送到不同的  D E F 三个消费着后，
每个消费者，消费信息的能力(时间) 不一样，所以就无法保证， A - B - C 三个消息的顺序消费的问题了
解决思路：
添加多个queue，把ABC 放到同一个queue中，而这个queue只有一个consumer。
更多细节:
https://xie.infoq.cn/article/c84491a814f99c7b9965732b1

关于消息堆积的问题；
往往是生成的速度大于了消费的速度；